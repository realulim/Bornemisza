<login-form>
    <div class="login">
        <h1>Member Authentication</h1>
        <form onsubmit="{handleLogin}">
            <div class="field">
                <p class="control has-icons-left">
                    <input name="user" type="text" value="" placeholder="Username or Email" required>
                    <span class="icon is-left"><i class="fa fa-user fa-fw"></i></span>
                </p>
            </div>
            <div class="field">
                <p class="control has-icons-left">
                    <input name="password" type="password" value="" placeholder="Password" required>
                    <span class="icon is-left"><i class="fa fa-lock fa-fw"></i></span>
                </p>
            </div>
            <div class="field">
                <p class="is-justified-left-and-right">
                    <span>Not a member yet? <a onclick="{flipDialog}" class="fliplink">Join us!</a></span>
                    <span><button type="submit">Sign in</button></span>
                </p>
            </div>
        </form>
    </div>
    <div id="{AUTH_FAILED}" class="is-size-6 msg msg-bad hidden">
        Authentication failed
        <a onclick="{hideAllMessages}" class="delete is-small msg-bad-close"></a>
    </div>
    <div id="{AUTH_SUCCESS}" class="is-size-6 msg msg-good hidden">
        Authenticated
        <a onclick="{hideAllMessages}" class="delete is-small msg-good-close"></a>
    </div>
    <div id="{AUTH_ERROR}" class="is-size-6 msg msg-bad hidden">
        Unexpected Error - please try again later.
        <a onclick="{hideAllMessages}" class="delete is-small msg-bad-close"></a>
    </div>
    <script>
        this.mixin(ObservableMixin);
        var self = this
        this.handleLogin = (event) => {
            event.preventDefault()
            for (let i = 0; i < event.target.length; i++) {
                if (event.target[i].name == 'user') var user = event.target[i].value
                else if (event.target[i].name == 'password') var password = event.target[i].value
            }
            var authHeader = createAuthorizationHeader(user, password)
            qwest.get(config.urlNewSession, null, {
                headers: {
                    "Authorization": authHeader
                }
            })
                .then(function (xhr, response) {
                    self.observable.trigger(AUTH_SUCCESS, { user: user })
                })
                .catch(function (e, xhr, response) {
                    if (xhr.status == 401) self.observable.trigger(AUTH_FAILED)
                    else self.observable.trigger(AUTH_ERROR, { status: xhr.status, response: xhr.responseText })
                })
            console.log("Sent AJAX request to " + config.urlNewSession)
        }
        this.observable.on(AUTH_FAILED, function () {
            shakeElement("card")
            displayMessage(AUTH_FAILED, false)
        })
        this.observable.on(AUTH_ERROR, function (opts) {
            console.log(AUTH_ERROR + ": " + opts.status + " " + opts.response)
            displayMessage(AUTH_ERROR, false)
        })
    </script>
</login-form>